#!/bin/bash
#
# terraform fmt only supports reformating one file at a time, so we'll use this
# small wrapper to accept options and paths and call it once per path with the
# same options each time.
#
# Usage:
#
#     terraform-fmt-multi [OPTION, ...] [--] [PATH, ...]
#
###
set -e

flags=()
paths=()

while [ -n "$1" ]; do
	case "$1" in
	# If we see help, output and exit here
	--help)
		terraform fmt --help
		exit $?
		;;

	--)
		shift
		break
		;;
	-*) flags+=("$1") ;;
	*) paths+=("$1") ;;
	esac

	shift
done

# Collect any remaining paths, in case -- was used.
paths+=("$@")

for path in "${paths[@]}"; do
	terraform fmt "${flags[@]}" "$path"
done
