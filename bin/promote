#!/usr/bin/env bash
set -euo pipefail

if (($# != 2)); then
  echo "Usage: bin/promote <file> <channel>" >&2
  exit 64
fi

if [[ ! -f "$1" ]]; then
  echo "<from> must be a file" >&2
  exit 1
fi

bucket=sites-docs-bucket-1vleclrg7tli7
prefix=data-files/restylers/manifests
name=restylers.yaml
distribution_id=E539B2WJC12CB

path=$1
channel=$2

aws s3 cp --acl public-read --content-type text/plain "$path" \
  "s3://$bucket/$prefix/$channel/$name"

aws cloudfront create-invalidation \
  --distribution-id "$distribution_id" \
  --paths "/$prefix/$channel/$name"
